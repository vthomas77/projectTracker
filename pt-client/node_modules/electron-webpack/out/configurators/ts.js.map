{"version":3,"sources":["../../src/configurators/ts.ts"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;AAEA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;;;;;2CAEO,WAAmC,YAAnC,EAAoE;AACzE,UAAM,eAAe,aAAa,gBAAb,CAA8B,gCAA9B,KAAmE,aAAa,gBAAb,CAA8B,qBAA9B,CAAxF;;AACA,QAAI,EAAE,gBAAgB,aAAa,gBAAb,CAA8B,WAA9B,CAAlB,CAAJ,EAAmE;AACjE;AACD,KAJwE,CAMzE;;;AACA,iBAAa,UAAb,CAAwB,MAAxB,CAA+B,CAA/B,EAAkC,CAAlC,EAAqC,KAArC,EAA4C,MAA5C;AAEA,UAAM,kBAAkB,aAAa,MAAb,IAAwB,gBAAgB,CAAC,aAAa,YAA9E;AAEA,UAAM,eAAe,MAAM,kCAAqB,CAAC,KAAK,IAAL,CAAU,aAAa,SAAvB,EAAkC,eAAlC,CAAD,EAAqD,KAAK,IAAL,CAAU,aAAa,UAAvB,EAAmC,eAAnC,CAArD,CAArB,EAAgI,IAAhI,CAA3B,CAXyE,CAYzE;;AACA,QAAI,gBAAgB,IAApB,EAA0B;AACxB,YAAM,IAAI,KAAJ,CAAU,uCAAuC,aAAa,UAAU,mFAAxE,CAAN;AACD;;AAED,QAAI,aAAa,KAAb,CAAmB,OAAvB,EAAgC;AAC9B,mBAAa,KAAb,CAAmB,SAAS,YAAY,EAAxC;AACD,KAnBwE,CAqBzE;;;AACA,QAAI,mBAAmB,CAAC,aAAa,MAArC,EAA6C;AAC3C,YAAM,6BAA6B,QAAQ,gCAAR,CAAnC;;AACA,mBAAa,OAAb,CAAqB,IAArB,CAA0B,IAAI,0BAAJ,CAA+B;AACvD,kBAAU,YAD6C;AAEvD,gBAAQ,aAAa,GAAb,CAAiB,mBAAjB,IAAwC;AAC9C,gBAAM,MAAK,CACT;AACD,WAH6C;AAK9C,gBAAM,QAAQ,IAAR,CAAa,IAAb,CAAkB,OAAlB,CALwC;AAM9C,iBAAO,QAAQ,KAAR,CAAc,IAAd,CAAmB,OAAnB;AANuC;AAFO,OAA/B,CAA1B;AAWD;;AAED,UAAM,kBAAuB;AAC3B;AACA;AACA,qBAAe,eAHY;AAI3B,wBAAkB,CAAC,QAAD,CAJS;AAK3B,kBAAY;AALe,KAA7B;;AAQA,QAAI,aAAa,KAAb,CAAmB,OAAvB,EAAgC;AAC9B,mBAAa,KAAb,CAAmB,sBAAsB,KAAK,SAAL,CAAe,eAAf,EAAgC,IAAhC,EAAsC,CAAtC,CAAwC,EAAjF;AACD;;AAED,iBAAa,KAAb,CAAmB,IAAnB,CAAwB;AACtB,YAAM,SADgB;AAEtB,eAAS,cAFa;AAGtB,WAAK,CACH;AACE,gBAAQ,WADV;AAEE,iBAAS;AAFX,OADG;AAHiB,KAAxB;AAUD,G;;kBA3DW,mB","sourcesContent":["import * as path from \"path\"\nimport { WebpackConfigurator } from \"../main\"\nimport { getFirstExistingFile } from \"../util\"\n\nexport async function configureTypescript(configurator: WebpackConfigurator) {\n  const hasTsChecker = configurator.hasDevDependency(\"fork-ts-checker-webpack-plugin\") || configurator.hasDevDependency(\"electron-webpack-ts\")\n  if (!(hasTsChecker || configurator.hasDevDependency(\"ts-loader\"))) {\n    return\n  }\n\n  // add after js\n  configurator.extensions.splice(1, 0, \".ts\", \".tsx\")\n\n  const isTranspileOnly = configurator.isTest || (hasTsChecker && !configurator.isProduction)\n\n  const tsConfigFile = await getFirstExistingFile([path.join(configurator.sourceDir, \"tsconfig.json\"), path.join(configurator.projectDir, \"tsconfig.json\")], null)\n  // check to produce clear error message if no tsconfig.json\n  if (tsConfigFile == null) {\n    throw new Error(`Please create tsconfig.json in the \"${configurator.projectDir}\":\\n\\n{\\n  \"extends\": \"./node_modules/electron-webpack/tsconfig-base.json\"\\n}\\n\\n`)\n  }\n\n  if (configurator.debug.enabled) {\n    configurator.debug(`Using ${tsConfigFile}`)\n  }\n\n  // no sense to use fork-ts-checker-webpack-plugin for production build\n  if (isTranspileOnly && !configurator.isTest) {\n    const ForkTsCheckerWebpackPlugin = require(\"fork-ts-checker-webpack-plugin\")\n    configurator.plugins.push(new ForkTsCheckerWebpackPlugin({\n      tsconfig: tsConfigFile,\n      logger: configurator.env.forkTsCheckerLogger || {\n        info: () => {\n          // ignore\n        },\n\n        warn: console.warn.bind(console),\n        error: console.error.bind(console),\n      }\n    }))\n  }\n\n  const tsLoaderOptions: any = {\n    // use transpileOnly mode to speed-up compilation\n    // in the test mode also, because checked during dev or production build\n    transpileOnly: isTranspileOnly,\n    appendTsSuffixTo: [/\\.vue$/],\n    configFile: tsConfigFile,\n  }\n\n  if (configurator.debug.enabled) {\n    configurator.debug(`ts-loader options: ${JSON.stringify(tsLoaderOptions, null, 2)}`)\n  }\n\n  configurator.rules.push({\n    test: /\\.tsx?$/,\n    exclude: /node_modules/,\n    use: [\n      {\n        loader: \"ts-loader\",\n        options: tsLoaderOptions\n      },\n    ],\n  })\n}"],"sourceRoot":""}
