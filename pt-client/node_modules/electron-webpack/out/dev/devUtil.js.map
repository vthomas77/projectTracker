{"version":3,"sources":["../../src/dev/devUtil.ts"],"names":[],"mappings":";;;;;;;;;;;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;;;;AAOA,SAAA,UAAA,CAAoB,CAApB,EAA+B,UAA/B,EAA4D;AAC1D,QAAM,QAAQ,EACX,IADW,GAEX,KAFW,CAEL,OAFK,EAGX,MAHW,CAGJ,MAAK;AACX,QAAI,cAAc,IAAd,IAAsB,CAAC,WAAW,MAAX,CAAkB,EAAlB,CAA3B,EAAkD;AAChD,aAAO,KAAP;AACD,KAHU,CAKX;AACA;;;AACA,QAAI,GAAG,QAAH,CAAY,0DAAZ,CAAJ,EAA6E;AAC3E,aAAO,KAAP;AACD;;AACD,QAAI,GAAG,QAAH,CAAY,yDAAZ,CAAJ,EAA4E;AAC1E,aAAO,KAAP;AACD;;AACD,WAAO,CAAC,GAAG,QAAH,CAAY,wEAAZ,CAAD,IACF,CAAC,GAAG,QAAH,CAAY,sBAAZ,CADC,IAEF,CAAC,GAAG,QAAH,CAAY,iCAAZ,CAFN;AAGD,GAnBW,CAAd;;AAqBA,MAAI,MAAM,MAAN,KAAiB,CAArB,EAAwB;AACtB,WAAO,IAAP;AACD;;AACD,SAAO,OAAO,MAAM,IAAN,CAAW,MAAX,CAAP,GAA4B,IAAnC;AACD;;AAEK,SAAA,qBAAA,CAAgC,KAAhC,EAAyE,YAAzE,EAAmG;AACvG,eAAa,MAAb,CAAoB,EAApB,CAAuB,MAAvB,EAA+B,QAAO;AACpC,eAAW,KAAX,EAAkB,KAAK,QAAL,EAAlB,EAAmC,iBAAM,GAAzC;AACD,GAFD;AAGD;;AAEK,SAAA,QAAA,CAAmB,KAAnB,EAA4D,KAA5D,EAAwE;AAC5E,aAAW,KAAX,EAAkB,MAAM,KAAN,IAAe,MAAM,QAAN,EAAjC,EAAmD,iBAAM,GAAzD;AACD;;AAED,MAAM,eAAe,EAArB;;AAEM,SAAA,UAAA,CAAqB,KAArB,EAA8D,IAA9D,EAAqF,UAArF,EAAsG,aAAgC,IAAtI,EAA0I;AAC9I,QAAM,MAAM,WAAW,KAAK,QAAL,EAAX,EAA4B,UAA5B,CAAZ;;AACA,MAAI,OAAO,IAAP,IAAe,IAAI,MAAJ,KAAe,CAAlC,EAAqC;AACnC;AACD;;AAED,UAAQ,MAAR,CAAe,KAAf,CACE,WAAW,IAAX,CAAgB,KAAK,KAAK,IAAI,IAAI,MAAJ,CAAW,eAAe,MAAM,MAArB,GAA8B,CAAzC,CAA2C,EAAzE,IACA,MADA,GACS,GADT,GACe,IADf,GAEA,WAAW,IAAX,CAAgB,KAAK,IAAI,MAAJ,CAAW,YAAX,CAAwB,EAA7C,CAFA,GAGA,IAJF;AAMD;;AAEK,MAAA,eAAA,CAAA;AAIJ,cAAY,QAAZ,EAAgC;AAFxB,SAAA,MAAA,GAA8B,IAA9B;;AAGN,SAAK,QAAL,GAAgB,MAAK;AACnB,WAAK,MAAL,GAAc,IAAd;AACA;AACD,KAHD;AAID;;AAED,aAAQ;AACN,SAAK,MAAL;AACA,SAAK,MAAL,GAAc,WAAW,KAAK,QAAhB,EAA0B,IAA1B,CAAd;AACD;;AAED,WAAM;AACJ,UAAM,SAAS,KAAK,MAApB;;AACA,QAAI,UAAU,IAAd,EAAoB;AAClB,WAAK,MAAL,GAAc,IAAd;AACA,mBAAa,MAAb;AACD;AACF;;AAtBG;;;;AAyBA,SAAA,YAAA,GAAA;AACJ,SAAA,OAAA,MAAA,CAAA,EAAA,EACK,QAAQ,GADb,EACgB;AACd,cAAU,aADI;AAEd;AACA,kBAAc,IAHA;AAId,cAAU;AAJI,GADhB,CAAA;AAOD,C","sourcesContent":["import chalk from \"chalk\"\nimport { ChildProcess } from \"child_process\"\n\nexport interface LineFilter {\n  filter(line: string): boolean\n}\n\nfunction filterText(s: string, lineFilter: LineFilter | null) {\n  const lines = s\n    .trim()\n    .split(/\\r?\\n/)\n    .filter(it => {\n      if (lineFilter != null && !lineFilter.filter(it)) {\n        return false\n      }\n\n      // https://github.com/electron/electron/issues/4420\n      // this warning can be safely ignored\n      if (it.includes(\"Couldn't set selectedTextBackgroundColor from default ()\")) {\n        return false\n      }\n      if (it.includes(\"Use NSWindow's -titlebarAppearsTransparent=YES instead.\")) {\n        return false\n      }\n      return !it.includes(\"Warning: This is an experimental feature and could change at any time.\")\n        && !it.includes(\"No type errors found\")\n        && !it.includes(\"webpack: Compiled successfully.\")\n    })\n\n  if (lines.length === 0) {\n    return null\n  }\n  return \"  \" + lines.join(`\\n  `) + \"\\n\"\n}\n\nexport function logProcessErrorOutput(label: \"Electron\" | \"Renderer\" | \"Main\", childProcess: ChildProcess) {\n  childProcess.stderr.on(\"data\", data => {\n    logProcess(label, data.toString(), chalk.red)\n  })\n}\n\nexport function logError(label: \"Electron\" | \"Renderer\" | \"Main\", error: Error) {\n  logProcess(label, error.stack || error.toString(), chalk.red)\n}\n\nconst LABEL_LENGTH = 28\n\nexport function logProcess(label: \"Electron\" | \"Renderer\" | \"Main\", data: string | Buffer, labelColor: any, lineFilter: LineFilter | null = null) {\n  const log = filterText(data.toString(), lineFilter)\n  if (log == null || log.length === 0) {\n    return\n  }\n\n  process.stdout.write(\n    labelColor.bold(`┏ ${label} ${\"-\".repeat(LABEL_LENGTH - label.length - 1)}`) +\n    \"\\n\\n\" + log + \"\\n\" +\n    labelColor.bold(`┗ ${\"-\".repeat(LABEL_LENGTH)}`) +\n    \"\\n\"\n  )\n}\n\nexport class DelayedFunction {\n  private readonly executor: () => void\n  private handle: NodeJS.Timer | null = null\n\n  constructor(executor: () => void) {\n    this.executor = () => {\n      this.handle = null\n      executor()\n    }\n  }\n\n  schedule() {\n    this.cancel()\n    this.handle = setTimeout(this.executor, 5000)\n  }\n\n  cancel() {\n    const handle = this.handle\n    if (handle != null) {\n      this.handle = null\n      clearTimeout(handle)\n    }\n  }\n}\n\nexport function getCommonEnv() {\n  return {\n    ...process.env,\n    NODE_ENV: \"development\",\n    // to force debug colors in the child process\n    DEBUG_COLORS: true,\n    DEBUG_FD: \"1\",\n  }\n}"],"sourceRoot":""}
